<div class="container-fluid">
  <nav class="navbar navbar-light bg-light">
    <span class="navbar-brand mb-0 h1">Welcome to Personality Test App</span>
  </nav>
  <div class="container my-3">
    <%= form_with url: "/calculateResult", method: :post, id: "meeting-form",
    id:'form', local: true do |f| %>
    <h4>Please Fill Following form for your Personality Test</h4>
    <i class="mr-2 fw-bold">All questions are required</i>
    <% (0...@questions.length).each do |i| %>
    <div id="step-<%= i + 1 %>" class="step">
      <div id="question-<%= i + 1 %>" class="m-3">
        <% question = @questions[i] %>
        <p><%= question.title %></p>
        <% question.options.each do |option| %>
        <label class="d-block">
          <%= radio_button_tag("question_#{question.id}", option.id) %> <%=
          option.title %>
        </label>
        <% end %>
      </div>
      <% if i >0 %>
      <button id="prev-<%= i + 1 %>" class="prev-btn">Previous</button>
      <% end %> <% if i == @questions.length - 1 %> <%= f.submit "Submit",
      class: "submit-btn btn btn-primary disabled" %> <% else %>

      <button id="next-<%= i + 1 %>" class="next-btn">Next</button>
      <% end %>
    </div>
    <% end %> <% end %>
  </div>
</div>

<script>
  $(document).ready(function (e) {
    // Hide all steps except the first one
    $(".step:not(#step-1)").hide();

    // Handle next button clicks
    $(".next-btn").click(function (e) {
      // console.log($('input[type=radio]:checked').length)
      e.preventDefault();
      var currentStep = $(this).closest(".step");
      var nextStep = currentStep.next(".step");
      currentStep.hide();
      nextStep.show();
    });

    // Handle previous button clicks
    $(".prev-btn").click(function (e) {
      // console.log($('input[type=radio]:checked').size())
      e.preventDefault();
      var currentStep = $(this).closest(".step");
      var prevStep = currentStep.prev(".step");
      currentStep.hide();
      prevStep.show();
    });

    // Handle form submission
    $('input[type="radio"]').click(function () {
      let checkedAnswers = $("input[type=radio]:checked").length;
      let count = parseInt("<%=@questions.count%>");
      if (count === checkedAnswers) {
        $(".submit-btn").removeClass("disabled");
      } else {
        $(".submit-btn").addClass("disabled");
      }
    });
  });
</script>
